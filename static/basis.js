//! basis 0.1.1
"use strict";!function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof module&&module.exports?module.exports=a():(0,eval)("this").basis=a()}(function(){var a={},b=a.Global=(0,eval)("this"),c=a.raise=function(){throw new Error(Array.prototype.slice.call(arguments,0).join(""))},d=a.raiseIf=function(a){a&&c.call(this,Array.prototype.slice.call(arguments,1))},e=a.callStack=function(a){if(a)return(a.stack||a.stacktrace||"").split("\n");try{throw new Error}catch(b){a=b}return(a.stack||a.stacktrace||"").split("\n").slice(1)},f=(a.obj=function(){for(var a={},b=0;b<arguments.length;b+=2)a[arguments[b]+""]=arguments[b+1];return a},a.copy=function(a){var b,c,d=1;for(arguments.length<2&&(a={},d=0);d<arguments.length;d++){c=arguments[d];for(b in c)c.hasOwnProperty(b)&&!a.hasOwnProperty(b)&&(a[b]=c[b])}return a},a.objects=function(){{var b=this.subconstructor=function(a,b){var c;return"function"!=typeof b&&(b=function(){a.apply(this,arguments)}),c=function(){},c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b},c=this.addMember=function(a,b,c,d){var e=b.split(/\s+/),b=e.pop(),f=a.prototype;return e.indexOf("static")>=0&&(f=a),d||"undefined"==typeof f[b]?e.indexOf("property")>=0?Object.defineProperty(f,b,c):f[b]=c:void 0},d=this.addMembers=function(a,b,d){Object.keys(b).map(function(e){c(a,e,b[e],d)})};a.declare=this.declare=function(){var a=Array.prototype.slice.call(arguments),e=a.length>1?a.shift():Object,f=a.length>0?a.pop():{},g=b(e,f.hasOwnProperty("constructor")?f.constructor:void 0),h=f[""];return Object.keys(f).map(function(a){""!==a&&"constructor"!==a&&c(g,a,f[a],!0)}),a.forEach(function(a){"function"==typeof a&&(a=a.prototype),d(g,a,!1)}),"function"==typeof h&&h.apply(g),g},this.unimplemented=function(a,b){return function(){throw new Error((this.constructor.name||a)+"."+b+"() not implemented! Please override.")}}}return this}.call({})),g=f.declare;String.prototype.repeat||(String.prototype.repeat=function(a){return a=0|a,0>=a?"":1&a?this+this.repeat(a-1):(this+this).repeat(a>>1)});var h=a.Text=g({constructor:function(){this.clear()},clear:function(){var a=this.text;return this.text="",a},add:function(){for(var a=0;a<arguments.length;a++)this.text+=arguments[a]},XML_ENTITIES:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXML:function(a){var b=h.prototype.XML_ENTITIES;return(a+"").replace(/[&<>"']/g,function(a){return b[a]})},addXML:function(){for(var a=0;a<arguments.length;a++)this.text+=this.escapeXML(arguments[a])},escapeRegExp:function(a){return(a+"").replace(/[\-\[\]{}()*+?.^$\\]/g,"\\$&")},formatDate:function(a,b,c){a=a||new Date;var d=h.lpad;return b?b.replace(/(y+|m+|d+|h+|H+|n+|s+|S+|a+|A+|"[^"]*")/g,function(b){switch(b.charAt(0)){case"y":return d((c?a.getUTCFullYear():a.getFullYear())+"",b.length,"0");case"m":return d((c?a.getUTCMonth():a.getMonth())+1+"",b.length,"0");case"d":return d((c?a.getUTCDate():a.getDate())+"",b.length,"0");case"h":return d((c?a.getUTCHours():a.getHours())+"",b.length,"0");case"H":return d((c?a.getUTCHours():a.getHours())%12+"",b.length,"0");case"n":return d((c?a.getUTCMinutes():a.getMinutes())+"",b.length,"0");case"s":return d((c?a.getUTCSeconds():a.getSeconds())+"",b.length,"0");case"S":return d((c?a.getUTCMilliseconds():a.getMilliseconds())+"",b.length,"0");case"a":return["am","pm"][~~((c?a.getUTCHours():a.getHours())/12)].substr(0,b.length);case"A":return["AM","PM"][~~((c?a.getUTCHours():a.getHours())/12)].substr(0,b.length);case'"':return b.substr(1,b.length-1);default:return b}}):a.toString()},addDate:function(a,b,c){this.text+=this.formatDate(a,b,c)},toString:function(){return this.text}});h.escapeXML=h.prototype.escapeXML,h.escapeRegExp=h.prototype.escapeRegExp,h.formatDate=h.prototype.formatDate,h.lpad=function(a,b,c){return isNaN(b)||a.length>=b?a:(c=(c||" ")+"",(c.repeat((b-a.length)/c.length+1)+a).substr(-b))},h.rpad=function(a,b,c){return isNaN(b)||a.length>=b?a:(c=(c||" ")+"",(a+c.repeat((b-a.length)/c.length+1)).substr(0,b))};var i=a.types={},j=a.Type=function(a){if(a=a||{},a.hasOwnProperty("isType")&&"function"==typeof a.isType&&(this.isType=a.isType),a.hasOwnProperty("isCompatible")&&"function"==typeof a.isCompatible&&(this.isCompatible=a.isCompatible),a.hasOwnProperty("coerce")&&"function"==typeof a.coerce&&(this.coerce=a.coerce),a.hasOwnProperty("toString")&&"string"==typeof a.toString){var b=a.toString;this.toString=function(){return b}}};j.prototype.isCompatible=function(a){return this.isType(a)},j.prototype.incompatibleError=function(a){return new TypeError("Value "+a+" is not compatible with type "+this+".")},j.prototype.coerce=function(a){throw this.incompatibleError(a)},i.BOOLEAN=new j({isType:function(a){return"boolean"==typeof a||void 0!==a&&null!==a&&a.constructor===Boolean},isCompatible:function(){return!0},coerce:function(a){return!!a},toString:"boolean"}),i.NUMBER=new j({isType:function(a){return"number"==typeof a||void 0!==a&&null!==a&&a.constructor===Number},isCompatible:function(){return!0},coerce:function(a){return+a},toString:"number"}),i.STRING=new j({isType:function(a){return"string"==typeof a||void 0!==a&&null!==a&&a.constructor===String},isCompatible:function(){return!0},coerce:function(a){return""+a},toString:"string"}),i.FUNCTION=new j({isType:function(a){return"function"==typeof a||void 0!==a&&null!==a&&a.constructor===Function},toString:"function"}),i.INTEGER=new j({isType:function(a){return a<<0===a},isCompatible:function(a){return!isNaN(a)},coerce:function(a){return+a>>0},toString:"integer"}),i.CHARACTER=new j({isType:function(a){return i.STRING.isType(a)&&1===a.length},isCompatible:function(a){return(""+a).length>0},coerce:function(a){return(""+a).charAt(0)},toString:"character"}),i.OBJECT=new j({isType:function(a){return"object"==typeof a},isCompatible:function(a){return"function"!=typeof a},coerce:function(a){switch(typeof a){case"function":throw this.incompatibleError(a);case"object":return a;default:return Object(a)}},toString:"object"});var k=i.ObjectType=function(a){j.call(this,{}),a.hasOwnProperty("constructor")&&"function"==typeof def.constructor?(this.instanceOf=a.constructor,delete a.constructor):this.instanceOf=null,this.members=a.members||{}};k.prototype=new j,k.prototype.constructor=k,k.prototype.isType=function(a){if("object"!=typeof a)return!1;if(this.instanceOf&&!(a instanceof this.instanceOf))return!1;for(var b in this.members)if(!this.members[b].isType(a[b]))return!1;return!0},k.prototype.isCompatible=function(a){if("object"!=typeof a)return!1;if(this.instanceOf&&!(a instanceof this.instanceOf))return!1;for(var b in this.members)if(!this.members[b].isCompatible(a[b]))return!1;return!0},k.prototype.coerce=function(a){var b=this.instanceOf?new this.instanceOf(a):{};for(var c in this.members)b[c]=this.members[c].coerce(a[c]);return b},i.ARRAY=new j({isType:function(a){return Array.isArray(a)},isCompatible:function(a){return this.isType(a)||"string"==typeof a},coerce:function(a){if(this.isType(a))return a;if("string"==typeof a)return a.split("");throw this.incompatibleError(a)},toString:"array"});var l=i.ArrayType=function(a,b){j.call(this,{}),a?Array.isArray(a)?(this.elementTypes=a,this.length=isNaN(b)?this.elementTypes.length:Math.max(+b,this.elementTypes.length)):(this.elementTypes=[a],this.length=+b):(this.elementTypes=[],this.length=+b)};l.prototype=new j,l.prototype.constructor=l,l.prototype.isType=function(a){if(!Array.isArray(a)||!isNaN(this.length)&&a.length!==this.length)return!1;if(this.elementTypes)for(var b,c=0,d=a.length;d>c;c++)if(b=this.elementTypes[Math.min(this.elementTypes.length-1,c)],!b.isType(a[c]))return!1;return!0},l.prototype.isCompatible=function(a){if(!Array.isArray(a)){if("string"!=typeof a)return!1;a=a.split("")}if(!isNaN(this.length)||a.length<+this.length)return!1;if(this.elementTypes)for(var b,c=0,d=a.length;d>c;c++)if(b=this.elementTypes[Math.min(this.elementTypes.length-1,c)],!b.isCompatible(a[c]))return!1;return!0},l.prototype.coerce=function(a){if(Array.isArray(a))a=a.slice();else{if("string"!=typeof a)throw this.incompatibleError(a);a=a.split("")}if(!isNaN(this.length))if(a.length>this.length)a=a.slice(0,this.length);else if(a.length<this.length)throw this.incompatibleError(a);if(this.elementTypes)for(var b,c=0,d=a.length;d>c;c++)b=this.elementTypes[Math.min(this.elementTypes.length-1,c)],a[c]=b.coerce(a[c]);return a};var m=a.Initializer=function(a,b){this.subject=a||{},this.args=b||{}};m.prototype.get=function(a,b){var c,d;if(b=b||{},this.args.hasOwnProperty(a))c=this.args[a];else{if(!b.hasOwnProperty("defaultValue"))throw new Error(b.missingValueError||"Missing argument <"+a+">!");c=b.defaultValue}if(d=b.type,d&&!d.isType(c)){if(!b.coerce)throw new Error(b.typeMismatchError||"Value for <"+a+"> must be a "+d+"!");c=d.coerce(c)}if(b.regexp&&!b.regexp.exec(c))throw new Error(b.invalidValueError||"Value <"+c+"> for <"+a+"> does not match "+b.regexp+"!");if(b.hasOwnProperty("minimum")&&b.minimum>c)throw new Error(b.invalidValueError||"Value <"+c+"> for <"+a+"> must be greater than or equal to "+b.minimum+"!");if(b.hasOwnProperty("maximum")&&b.maximum<c)throw new Error(b.invalidValueError||"Value <"+c+"> for <"+a+"> must be less than or equal to "+b.maximum+"!");return"function"==typeof b.check&&b.check.call(this.subject,c,a,b),c},m.prototype.attr=function(a,b){b=b||{};try{if(b.hasOwnProperty("overwrite")&&!b.overwrite&&this.subject.hasOwnProperty(a))throw new Error(b.attrOverwriteError||"Attribute <"+a+"> is already defined!");this.subject[a]=this.get(a,b)}catch(c){if(!b.ignore)throw c}return this},m.prototype.bool=function(a,b){return b=b||{},b.type=i.BOOLEAN,this.attr(a,b)},m.prototype.string=function(a,b){return b=b||{},b.type=i.STRING,this.attr(a,b)},m.prototype.number=function(a,b){return b=b||{},b.type=i.NUMBER,this.attr(a,b)},m.prototype.integer=function(a,b){return b=b||{},b.type=i.INTEGER,this.attr(a,b)},m.prototype.func=function(a,b){return b=b||{},b.type=i.FUNCTION,this.attr(a,b)},m.prototype.array=function(a,b){return b=b||{},b.type=b.hasOwnProperty("length")||b.hasOwnProperty("elementType")?new i.ArrayType(b.elementType,b.length):i.ARRAY,this.attr(a,b)},m.prototype.object=function(a,b){return b=b||{},b.type=i.OBJECT,this.attr(a,b)};var n=a.initialize=function(a,b){return new m(a,b)},o=a.Iterable=function z(a){if(null===a||void 0===a)throw new Error("Iterable source is null or undefined.");this.__iter__="function"==typeof a?a:"string"==typeof a?z.__iteratorFromString__(a):Array.isArray(a)?z.__iteratorFromArray__(a):"object"==typeof a?"function"==typeof a.__iter__?a.__iter__.bind(a):z.__iteratorFromObject__(a):z.__iteratorSingleton__(a)},p=o.STOP_ITERATION=new Error("Sequence has ended.");o.prototype.stop=function(){throw p},o.prototype.catchStop=function(a){if(a!==p)throw a};var q=a.iterable=function(a){return a instanceof o?a:new o(a)};o.EMPTY=new o(function(){return o.prototype.stop}),o.__iteratorFromString__=function(a){return function(){var b=0;return function(){if(b<a.length)return a.charAt(b++);throw p}}},o.__iteratorFromArray__=function(a){return function(){var b=0;return function(){if(b<a.length)return a[b++];throw p}}},o.__iteratorFromObject__=function(a){return function(){var b=Object.keys(a);return function(){if(b.length>0){var c=b.shift();return[c,a[c]]}throw p}}},o.__iteratorSingleton__=function(a){return function(){var b=!1;return function(){if(b)throw p;return b=!0,a}}},o.prototype.forEach=function(a,b){var c,d,e=this.__iter__(),f=0;try{for(c=e();!0;c=e(),f++)(!b||b(c,f))&&(d=a(c,f))}catch(g){this.catchStop(g)}return d},o.prototype.toArray=function(a){return a=a||[],this.forEach(function(b){a.push(b)}),a},o.prototype.toObject=function(a){return a=a||{},this.forEach(function(b){a[b[0]]=b[1]}),a},o.prototype.isEmpty=function(){try{return this.__iter__()(),!1}catch(a){return this.catchStop(a),!0}},o.prototype.count=function(){var a=0;return this.forEach(function(){a++}),a},o.prototype.join=function(a){var b="";return a=""+(a||""),this.forEach(function(c,d){b+=0===d?c:a+c}),b},o.prototype.sum=function(a){var b=isNaN(a)?0:+a;return this.forEach(function(a){b+=+a}),b},o.prototype.min=function(a){var b=isNaN(a)?1/0:+a;return this.forEach(function(a){a=+a,b>a&&(b=a)}),b},o.prototype.max=function(a){var b=isNaN(a)?-1/0:+a;return this.forEach(function(a){a=+a,a>b&&(b=a)}),b},o.prototype.all=function(a,b){a="function"==typeof a?a:function(a){return!!a};var c=!0;return this.forEach(function(d){if(!a(d)&&(c=!1,!b))throw p}),c},o.prototype.any=function(a,b){a="function"==typeof a?a:function(a){return!!a};var c=!1;return this.forEach(function(d){if(a(d)&&(c=!0,!b))throw p}),c},o.prototype.map=function(a,b){var c=this;return new o(function(){var d,e=c.__iter__(),f=-1;return function(){for(d=e();!0;d=e())if(f++,d=a?a(d,f):d,!b||b(d,f))return d;throw p}})},o.prototype.filter=function(a,b){var c=this;return new o(function(){var d,e=c.__iter__(),f=-1;return function(){for(;;)if(d=e(),f++,a?a(d,f):d)return b?b(d,f):d;throw p}})},o.prototype.foldl=function(a,b){var c,d=this.__iter__();try{for(b=void 0===b?d():b,c=d();!0;c=d())b=a(b,c)}catch(e){this.catchStop(e)}return b},o.prototype.scanl=function(a,b){var c=this;return new o(function(){var d,e=c.__iter__(),f=-1;return function(){return f++,d=0==f?void 0===b?e():b:a(d,e())}})},o.prototype.head=function(a){try{return this.__iter__()()}catch(b){if(this.catchStop(b),arguments.length<1)throw new Error("Tried to get the head value of an empty Iterable.");return a}},o.prototype.last=function(a){var b,c=!0,d=this.__iter__();try{for(c=!0;!0;c=!1)b=d()}catch(e){if(this.catchStop(e),c){if(arguments.length<1)throw new Error("Tried to get the last value of an empty Iterable.");return a}return b}},o.prototype.reverse=function(){return new o(this.toArray().reverse())},o.prototype.foldr=function(a,b){function c(b,c){return a(c,b)}return this.reverse().foldl(c,b)},o.prototype.scanr=function(a,b){function c(b,c){return a(c,b)}return this.reverse().scanl(c,b)},o.prototype.zip=function(){var a=Array.prototype.slice.call(arguments).map(q);return a.unshift(this),new o(function(){var b=a.map(function(a){return a.__iter__()});return function(){return b.map(function(a){return a()})}})},o.prototype.sorted=function(a){return new o(this.toArray().sort(a))},o.prototype.cycle=function(a){a=void 0===a?1/0:+a;var b=this;return new o(function(){var c=a,d=b.__iter__();return function(){for(;c>0;)try{return d()}catch(a){if(!(a===p&&c>1))throw a;c--,d=b.__iter__()}throw p}})},o.prototype.product=function(){var a=Array.prototype.slice.call(arguments).map(q);return a.unshift(this),new o(function(){var b,c=a.map(function(a){return a.__iter__()});return function(){if(b)for(var d=c.length-1;!0;d--)try{b[d]=c[d]();break}catch(e){if(!(d>0&&e===p))throw e;c[d]=a[d].__iter__(),b[d]=c[d]()}else b=c.map(function(a){return a()});return b.slice(0)}})},o.prototype.chain=function(){var a=Array.prototype.slice.call(arguments).map(q);return a.unshift(this),new o(function(){var b=0,c=a[0].__iter__();return function(){for(;;)try{return c()}catch(d){if(!(d===p&&b+1<a.length))throw d;b++,c=a[b].__iter__()}throw p}})},o.prototype.flatten=function(){var a=this.__iter__();return new o(function(){var b=this.stop;return function(){for(;;)try{return b()}catch(c){c===p&&(b=q(a()).__iter__())}throw p}})},o.prototype.pluck=function(a){return this.map(function(b){return b[a]})},o.prototype.greater=function(a){a="function"==typeof a?a:function(a){return+a};var b,c=-1/0,d=[];return this.forEach(function(e){b=a(e),b>c?(c=b,d=[e]):c==b&&d.push(e)}),d},o.prototype.lesser=function(a){a="function"==typeof a?a:function(a){return+a};var b,c=1/0,d=[];return this.forEach(function(e){b=a(e),c>b?(c=b,d=[e]):c==b&&d.push(e)}),d},o.prototype.sample=function(a,b){b=b||u.DEFAULT;var c=[];return this.forEach(function(d,e){var f=b.random();c.length<a?c.push([f,d,e]):f<c[c.length-1][0]&&(c.push([f,d,e]),c.sort(function(a,b){return a[0]-b[0]}),c.pop())}),c.sort(function(a,b){return a[2]-b[2]}),new o(c.map(function(a){return a[1]}))},o.range=function(a,b,c){switch(arguments.length){case 0:a=0,b=0,c=1;break;case 1:b=a,a=0,c=1;break;case 2:c=1}return new o(function(){var d,e=a;return function(){if(isNaN(e)||isNaN(b)||e>=b)throw p;return d=e,e+=c,d}})},o.repeat=function(a,b){return b=isNaN(b)?1/0:+b,new o(function(){var c=b;return function(){if(c--,0>c)throw p;return a}})},o.iterate=function(a,b,c){return c=isNaN(c)?1/0:+c,new o(function(){var d=c,e=b;return function(){if(d--,0>d)throw p;var b=e;return e=a(e),b}})},o.product=function(a){return arguments.length<1?o.EMPTY:(a=q(a),a.product.apply(a,Array.prototype.slice.call(arguments,1)))};var r=a.Future=g({constructor:function(a){this.state=0,this.callbacks=[[],[],[]],arguments.length>0&&this.resolve(a)},STATES:["pending","resolved","rejected","cancelled"],__complete__:function(a,b,c){return 0===this.state&&(this.state=c,this.__completion__=[a,b],this.callbacks[c-1].forEach(function(c){"function"==typeof c&&setTimeout(c.bind(a,b),1)})),this},resolve:function(a,b){return 0===this.state?this.__complete__(b||this,a,1):this},reject:function(a,b){if(0===this.state&&(this.__complete__(b||this,a,2),this.callbacks[1].length<1))throw a instanceof Error?a:new Error(a);return this},cancel:function(a){return 0===this.state?this.__complete__(this,a,3):this},bind:function(a){return a.done(this.resolve.bind(this)),a.fail(this.reject.bind(this)),a.__onCancel__(this.cancel.bind(this)),this},__register__:function(a,b){if("function"==typeof a)return 0===this.state?this.callbacks[b-1].push(a):this.state===b&&setTimeout(a.bind(this.__completion__[0],this.__completion__[1]),1),this;throw new Error("Callback must be a function, and not "+a)},done:function(){for(var a=0;a<arguments.length;a++)this.__register__(arguments[a],1);return this},fail:function(){for(var a=0;a<arguments.length;a++)this.__register__(arguments[a],2);return this},__onCancel__:function(){for(var a=0;a<arguments.length;a++)this.__register__(arguments[a],3);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},isPending:function(){return 0===this.state},isResolved:function(){return 1===this.state},isRejected:function(){return 2===this.state},isCancelled:function(){return 3===this.state},then:function(a,b){var c=new r;return this.done(function(b){try{b=a?a(b):b,b instanceof r?c.bind(b):c.resolve(b)}catch(d){c.reject(d)}}),this.fail(function(a){if(b)try{a=b(a),a instanceof r?c.bind(a):c.resolve(a)}catch(d){c.reject(d)}else c.reject(a)}),this.__onCancel__(c.cancel.bind(c)),c},toString:function(){return"Future:"+this.STATES[this.state]},"static when":function(a){return a instanceof r?a:new r(a)},"static invoke":function(a,b){try{return s(a.apply(b,Array.prototype.slice.call(arguments,2)))}catch(c){var d=new r;return d.reject(c),d}},"static all":function(a){a=Array.isArray(a)?a:q(a).toArray();var b,c=new r,d=a.length,e=new Array(d),f=function(a,b){e[a]=b,--d<1&&c.resolve(e)};if(1>d)c.resolve([]);else for(var g=0;g<a.length;g++)b=s(a[g]),b.done(f.bind(this,g)),b.fail(c.reject.bind(c)),b.__onCancel__(c.cancel.bind(c));return c},"static any":function(a){a=iterables.iterable(a).toArray();var b,c=new r,d=a.length,e=new Array(d);if(1>d)c.reject();else for(var f=0;f<a.length;f++)b=s(a[f]),b.fail(function(a){return function(b){e[a]=b,d--,1>d&&c.reject(b)}}(f)),b.done(c.resolve.bind(c)),b.__onCancel__(c.cancel.bind(c));return c},"static sequence":function(a,b){var c,d=new r,e=d.reject.bind(d),f=q(a).__iter__(),g=function h(a){try{return c=f(),b?s(c).then(b,e).then(h,e):s(c).then(h,e)}catch(g){g===p?d.resolve(a):d.reject(g)}};return g(),d},"static doWhile":function(a,b){function c(f){r.invoke(b,this,f).then(function(b){b?r.invoke(a,this,f).then(c,e):d.resolve(f)},e)}b=b||function(a){return!!a};var d=new r,e=d.reject.bind(d);return r.invoke(a).then(c,e),d},"static whileDo":function(a,b){return r.invoke(a).then(function(){return r.doWhile(b,a)})},"static delay":function(a,b){a=isNaN(a)?10:Math.max(+a,10),b="undefined"==typeof b?Date.now():b;var c=new r;return setTimeout(c.resolve.bind(c,b),a),c},"static retrying":function(a,b,c,d,e){return b=isNaN(b)?10:+b,1>b?r.invoke(a):r.invoke(a).then(void 0,function(){return c=isNaN(c)?100:+c,d=isNaN(d)?2:+d,e=isNaN(e)?3e5:+e,r.delay(c).then(function(){return r.retrying(a,b-1,Math.min(e,c*d),d,e)})})},"static imports":function(){var a=new r;return require(Array.prototype.slice.call(arguments),function(){a.resolve(Array.prototype.slice.call(arguments))},function(b){a.reject(b)}),a}}),s=r.when,t=a.HttpRequest=g({constructor:function(){this.__request__=new XMLHttpRequest},request:function(a,b,c,d,e,f){var g=this.__request__,h=new r;return g.open(a,b,!0,e,f),d&&Object.getOwnPropertyNames(d).forEach(function(a){g.setRequestHeader(a,d[a])}),g.onreadystatechange=function(){4==g.readyState&&(200==g.status?h.resolve(g):h.reject(g))},g.send(c),h},get:function(a,b,c,d,e){return this.request("GET",a,b,c,d,e)},getText:function(a,b,c,d,e){return this.get(a,b,c,d,e).then(function(a){return a.responseText})},getJSON:function(a,b,c,d,e){return this.get(a,b,c,d,e).then(function(a){return JSON.parse(a.responseText)})},post:function(a,b,c,d,e){return this.request("POST",a,b,c,d,e)},postJSON:function(a,b,c,d,e){return c=c||{},c["Content-Type"]="application/json",this.post(a,JSON.stringify(b)||"null",c,d,e)}});["request","get","getJSON","getText","post","postJSON"].forEach(function(a){t[a]=function(){return t.prototype[a].apply(new t,arguments)}});var u=(a.Events=g({constructor:function(a){n(this,a).number("maxListeners",{defaultValue:1/0,coerce:!0,minimum:1}).bool("isOpen",{defaultValue:!0});var b=this.__listeners__={};a&&Array.isArray(a.events)&&a.events.forEach(function(a){b[a]=[]})},listeners:function(a){return this.__listeners__.hasOwnProperty(a)?this.__listeners__[a].slice():[]},emit:function(a){var c;if(Array.isArray(a)){var d=this;c=Array.prototype.slice.call(arguments),a.forEach(function(a){c[0]=a,d.emit.apply(this,c)})}if(!this.__listeners__.hasOwnProperty(a))return!1;c=Array.prototype.slice.call(arguments,1);this.__listeners__[a];return this.__listeners__[a]=this.__listeners__[a].filter(function(a){return a[1]>0?(setTimeout(function(){return a[0].apply(b,c)},1),a[1]--,a[1]>0):!1}),!0},on:function(a,b,c){if(Array.isArray(a)){var e=this;a.forEach(function(a){e.on(a,b,c)})}else{this.__listeners__.hasOwnProperty(a)||(d(!this.isOpen,"Event ",a," is not defined."),this.__listeners__[a]=[]);var f=this.__listeners__[a];d(this.listeners.length>=this.maxListeners,"Cannot have more than ",this.maxListeners," listeners for event ",a,"."),c=+c||1/0,f.push([b,c])}},once:function(a,b){return this.on(a,b,1)},off:function(a,b){if(Array.isArray(a)){var c=this;a.forEach(function(a){c.off(a,b,times)})}else this.__listeners__.hasOwnProperty(a)&&(this.__listeners__[a]=this.__listeners__[a].filter(function(a){return a[0]!==b}))}}),a.Randomness=g({constructor:function(a){this.__random__=a||Math.random},random:function(){var a=this.__random__();switch(arguments.length){case 0:return a;case 1:return a*arguments[0];default:return(1-a)*arguments[0]+a*arguments[1]}},randomInt:function(){return Math.floor(this.random.apply(this,arguments))},randomBool:function(a){return this.random()<(isNaN(a)?.5:+a)},randoms:function(a){var b,c=Array.prototype.slice.call(arguments,1),d=[];for(a=+a,b=0;a>b;b++)d.push(this.random.apply(this,c));return d},choice:function(a){return a=arguments.length>1?Array.prototype.slice.call(arguments):Array.isArray(a)?a:q(a).toArray(),a.length<1?void 0:a[this.randomInt(a.length)]},split:function(a,b){b=arguments.length>2?Array.prototype.slice.call(arguments):q(b).toArray();var c=[];for(a=Math.min(b.length,Math.max(+a,0));a>0;a--)c=c.concat(b.splice(this.randomInt(b.length),1));return[c,b]},choices:function(){return this.split.apply(this,arguments)[0]},shuffle:function(a){return this.choices(a.length,a)},weightedChoices:function(a,b){var c,d=0,e=1/0,f=0,g=[];q(b).forEach(function(a){var b=a[0];d+=b,e>b&&(e=b),f++}),d-=e*f,b=q(b).map(function(a){return[(a[0]-e)/d,a[1]]}).toArray();for(var h=0;a>h&&b.length>0;h++){c=this.random();for(var i=0;i<b.length;i++)if(c-=b[i][0],0>=c){g.push(b[i][1]),b.splice(i,1);break}g.length<=h&&(g.push(b[0][1]),b.splice(0,1))}return g},averagedDistribution:function(a){a=Math.max(+a,2);var b=this.__random__;return new u(function(){for(var c=0,d=0;a>d;d++)c+=b();return c/a})}}));u.DEFAULT=new u,["random","randomInt","randomBool","choice","split","choices","shuffle","averagedDistribution"].forEach(function(a){u[a]=u.DEFAULT[a].bind(u.DEFAULT)}),u.linearCongruential=function(a,b,c){return function(d){var e=d||0;return new u(function(){return(e=(b*e+c)%a)/a})}},u.linearCongruential.numericalRecipies=u.linearCongruential(4294967295,1664525,1013904223),u.linearCongruential.borlandC=u.linearCongruential(4294967295,22695477,1),u.linearCongruential.glibc=u.linearCongruential(4294967295,1103515245,12345);var v=a.Chronometer=g({constructor:function(a){this.reset(a)},reset:function(a){return this.__timestamp__=a||(new Date).getTime()},time:function(){return(new Date).getTime()-this.__timestamp__},tick:function(){var a=this.time();return this.reset(),a},chronometer:function(a,b){b=b||1;for(var c=0,d=0;b>d;d++)this.reset(),a.call(this),c+=this.time();return c/b}}),w=a.Statistic=g({constructor:function(a){switch(typeof a){case"undefined":break;case"object":if(null!==a){this.keys=a;break}default:this.keys=null===a?"":a+""}this.reset()},reset:function(){return this.__count__=0,this.__sum__=0,this.__sqrSum__=0,this.__min__=1/0,this.__max__=-1/0,this.__minData__=void 0,this.__maxData__=void 0,this},applies:function(a){if("undefined"==typeof a)return!1;switch(null===a&&(a=""),typeof this.keys){case"undefined":return!1;case"object":if("object"==typeof a){if(Array.isArray(this.keys)&&Array.isArray(a)){for(var b in a)if(this.keys.indexOf(a[b])<0)return!1}else for(var b in a)if("undefined"==typeof this.keys[b]||a[b]!==this.keys[b])return!1;return!0}return!1;default:return"object"!=typeof a&&this.keys===a+""}},add:function(a,b){return void 0===a?a=1:isNaN(a)&&c("Statistics.add(): Value ",a," cannot be added."),this.__count__+=1,this.__sum__+=a,this.__sqrSum__+=a*a,this.__min__>a&&(this.__min__=a,this.__minData__=b),this.__max__<a&&(this.__max__=a,this.__maxData__=b),this},DEFAULT_GAIN_FACTOR:.99,gain:function(a,b,c){return b=isNaN(b)?this.DEFAULT_GAIN_FACTOR:+b,this.__count__*=b,this.__sum__*=b,this.__sqrSum__*=b,this.add(a,c)},addAll:function(a,b){for(var c=0;c<a.length;c++)this.add(a[c],b);return this},gainAll:function(a,b,c){for(var d=0;d<a.length;d++)this.gain(a[d],b,c);return this},count:function(){return this.__count__},sum:function(){return this.__sum__},squareSum:function(){return this.__sqrSum__},minimum:function(){return this.__min__},maximum:function(){return this.__max__},minData:function(){return this.__minData__},maxData:function(){return this.__maxData__},average:function(){var a=this.count();return a>0?this.sum()/a:0},variance:function(a){isNaN(a)&&(a=this.average());var b=this.count();return b>0?a*a+(this.squareSum()-2*a*this.sum())/b:0},standardDeviation:function(a){return Math.sqrt(this.variance(a))},startTime:function(a){var b=this.__chronometer__||(this.__chronometer__=new v);return b.reset(a)},addTime:function(a){return d(!this.__chronometer__,"Statistic's chronometer has not been started."),this.add(this.__chronometer__.time(),a)},addTick:function(a){return d(!this.__chronometer__,"Statistic's chronometer has not been started."),this.add(this.__chronometer__.tick(),a)},addStatistic:function(a){return this.__count__+=a.__count__,this.__sum__+=a.__sum__,this.__sqrSum__+=a.__sqrSum__,a.__min__<this.__min__&&(this.__min__=a.__min__,this.__maxData__=a.__maxData__),a.__max__>this.__max__&&(this.__max__=a.__max__,this.__maxData__=a.__maxData__),this},toString:function(a){return a=""+(a||"	"),[Object.keys(this.keys).join(" "),this.count(),this.minimum(),this.average(),this.maximum(),this.standardDeviation()].join(a)}}),x=a.Statistics=g({constructor:function(){this.__stats__={}},stats:function(a){return q(this.__stats__).map(function(a){return a[1]},function(b){return b.applies(a)}).toArray()},__id__:function(a){return"object"==typeof a&&null!==a?Array.isArray(a)?JSON.stringify(a.slice().sort()):Object.keys(a).sort().map(function(b){return JSON.stringify(b)+":"+JSON.stringify(a[b])}).join(","):JSON.stringify(a)+""},stat:function(a){var b=this.__id__(a);return this.__stats__[b]||(this.__stats__[b]=new w(a))},reset:function(a){return this.stats(a).forEach(function(a){a.reset()}),this},add:function(a,b,c){return this.stat(a).add(b,c)},gain:function(a,b,c,d){return this.stat(a).gain(b,c,d)},addAll:function(a,b,c){return this.stat(a).addAll(b,c)},gainAll:function(a,b,c,d){return this.stat(a).addAll(b,d)},addObject:function(a,b){d(!a,"Cannot add object "+JSON.stringify(a)+".");for(var c in a)Array.isArray(a[c])?this.addAll(c,a[c],b):this.add(c,a[c],b);return this},addStatistic:function(a,b){return this.stat("undefined"!=typeof b?b:a.keys).addStatistic(a)},addStatistics:function(a,b){var c=this;return a.stats(b).forEach(function(a){c.stat(a.keys).addStatistic(a)}),this},accumulation:function(a){var b=new w(a);return this.stats(a).forEach(function(a){b.addStatistic(a)}),b},count:function(a){return this.accumulation(a).count()},sum:function(a){return this.accumulation(a).sum()},squareSum:function(a){return this.accumulation(a).squareSum()},minimum:function(a){return this.accumulation(a).minimum()},maximum:function(a){return this.accumulation(a).maximum()},average:function(a){return this.accumulation(a).average()},variance:function(a,b){return this.accumulation(a).variance(b)},standardDeviation:function(a,b){return this.accumulation(a).standardDeviation(b)},startTime:function(a,b){return this.stat(a).startTime(b)},addTime:function(a,b){return this.stat(a).addTime(b)},addTick:function(a,b){return this.stat(a).addTick(b)},toString:function(a,b){a=""+(a||"	"),b=""+(b||"\n");var c=this.__stats__;return Object.keys(c).map(function(b){return c[b].toString(a)}).join(b)}}),y=a.Logger=g({constructor:function A(a,b,c){this.name=""+a,this.parent=b||A.ROOT,this.level=c||"INFO",this.appenders=[]},LEVELS:{TRACE:-1/0,DEBUG:-1,INFO:0,WARN:1,ERROR:2,FATAL:1/0,OK:0,FAIL:1,TODO:1,FIXME:1},log:function(a){var b=this.LEVELS[this.level]<=this.LEVELS[a];if(b){var c=this,d=Array.prototype.slice.call(arguments,1).join("");this.appenders.forEach(function(b){var e=b.format||c.defaultFormat;b(e(c.name,new Date,a,d))}),this.parent&&this.parent.log.apply(this.parent,arguments)}return b},trace:function(){return this.log("TRACE",Array.prototype.slice.call(arguments,0).join(""))},debug:function(){return this.log("DEBUG",Array.prototype.slice.call(arguments,0).join(""))},info:function(){return this.log("INFO",Array.prototype.slice.call(arguments,0).join(""))},warn:function(){return this.log("WARN",Array.prototype.slice.call(arguments,0).join(""))},error:function(){return this.log("ERROR",Array.prototype.slice.call(arguments,0).join(""))},fatal:function(){return this.log("FATAL",Array.prototype.slice.call(arguments,0).join(""))},defaultFormat:function(a,b,c,d){return[c,a,h.formatDate(b,"hhnnss.SSS"),d].join(" ")},htmlFormat:function(a,b){return a=a||"p",b=b||"log_",function(c,d,e,f){return["<",a,' class="',b,e,'">','<span class="',b,'level">',e,"</span> ",'<span class="',b,'name">',c,"</span> ",'<span class="',b,'time">',h.formatDate(d,"hhnnss.SSS"),"</span> ",'<span class="',b,'message">',h.escapeXML(f).replace(/\n/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),"</span>","</",a,">"].join("")}},appendToConsole:function(){function a(a){console.log(a)}return function(){return this.appenders.push(a),a}}(),appendToFile:function(a,b,c){function d(a){e.write(a+"\n")}a=a||"./log"+(new Date).format("yyyymmdd-hhnnss")+".log",b=void 0!==b?b:"a",c=void 0!==c?c:"utf-8";var e=require("fs").createWriteStream(a,{flags:b,encoding:c});return this.appenders.push(d),d},appendToHtml:function(a,b,c){function d(d){if(c)for(e.unshift(d);e.length>b;)e.pop();
else for(e.push(d);e.length>b;)e.shift();a.innerHTML=e.join("\n")}b=+b||1/0,c=!!c,a="string"==typeof a?document.getElementById(a):a||document.getElementsByTagName("body")[0];var e=[];return this.appenders.push(d),d},appendAsWorkerMessages:function(a){function b(b){var c={};c[a]=b,self.postMessage(JSON.stringify(c))}return a=""+(a||"log"),b.format=function(a,b,c,d){return{name:a,time:b,level:c,message:d}},this.appenders.push(b),b},stats:function(){return this.__stats__||(this.__stats__=new x)}});y.ROOT=new y("");a.Verifier=g({constructor:function(a){this.logger=a||y.ROOT,this.tests=[]},test:function(a,b){d("function"!=typeof b,"Verifier.append() expects a function."),this.tests.push([a||b.name,b])},failure:function(a,b){var c=new Error(b);return c.isFailure=!0,c.level=a,c},fail:function(){throw this.failure("FAIL",Array.prototype.slice.call(arguments).join(""))},__logFailure__:function(a,b){var c="\n	"+e(b).slice(0,10).join("\n	");b&&b.isFailure?this.logger.log(b.level,"Test ",a," failed after ",chronometer.time(),"ms. Failure: ",b.message,c):this.logger.error("Test ",a," aborted after ",chronometer.time(),"ms. Error: ",b,c)},run:function(){function a(a,d){var f="\n	"+e(d).slice(0,10).join("\n	");d&&d.isFailure?b.logger.log(d.level,"Test ",a," failed after ",c.time(),"ms. Failure: ",d.message,f):b.logger.error("Test ",a," aborted after ",c.time(),"ms. Error: ",d,f)}var b=this,c=new v,d=0;return r.sequence(this.tests,function(e){var f=e[0],g=e[1];c.reset();try{return r.invoke(g,b).then(function(a){b.logger.log("OK",f," passed after ",c.time(),"ms. ",a),d++},a.bind(b,f))}catch(h){a.call(b,f,h)}}).then(function(){b.logger.info("Finished: ",d,"/",b.tests.length," tests were successful.")})},todo:function(){this.logger.log("TODO",Array.prototype.slice.call(arguments).join(""))},__assert__:function(a,b,c){if(!a){var d=(b.length>c?Array.prototype.slice.call(b,c):Array.prototype.slice.call(arguments,3)).join("");this.fail(d)}},assert:function(a){this.__assert__(a,arguments,1,"Assertion failed!")},assertFalse:function(a){this.__assert__(!a,arguments,1,"Assertion failed!")},assertSucceeds:function(a){try{return a.call(this)}catch(b){return this.fail("Execution of ",a.name||"\n"+a+"\n"," should not have failed but it did! The error was: ",b)}},assertFails:function(a,b){try{return a.call(this)}catch(c){return!b||c instanceof b||this.fail("Execution of \n",a.name||"\n"+a+"\n","\n should have failed with an error of type ",b," but raised ",c,"."),c}return this.fail("Execution of \n",a.name||"\n"+a+"\n","\n should have failed but it did not!")},assertNull:function(a){this.__assert__(null===a,arguments,1,"Object ",a," should be null.")},assertNotNull:function(a){this.__assert__(null!==a,arguments,1,"Object ",a," should not be null.")},assertUndefined:function(a){this.__assert__(void 0===a,arguments,1,"Object ",a," should be undefined.")},assertDefined:function(a){this.__assert__(void 0!==a,arguments,1,"Object ",a," should be defined.")},assertEqual:function(a,b){this.__assert__(a==b,arguments,2,"Value ",b," should be equal (==) to ",a,".")},assertNotEqual:function(a,b){this.__assert__(a!=b,arguments,2,"Value ",b," should not be equal (!=) to ",a,".")},assertSame:function(a,b){this.__assert__(a===b,arguments,2,"Value ",b," should be the same (===) as ",a,".")},assertNotSame:function(a,b){this.__assert__(a!==b,arguments,2,"Value ",b," should not be the same (!==) as ",a,".")},EPSILON:1/268435456,assertAlmostEqual:function(a,b,c){c=isNaN(c)?this.EPSILON:+c,this.__assert__(Math.abs(a-b)<=c,arguments,3,"Value ",b," should not be so different (up to ",c,") of ",a,".")},assertInstanceOf:function(a,b){this.__assert__(b instanceof a,arguments,2,"Object ",b," should be an instance of ",a,".")},assertIsFunction:function(a){this.__assert__("function"==typeof a,arguments,1,"Value ",a," is not a function.")},assertIsArray:function(a,b){this.__assert__(Array.isArray(a),arguments,2,"Expected value is not an Array."),this.__assert__(Array.isArray(b),arguments,2,JSON.stringify(b)," is not an Array."),this.__assert__(a.length===b.length,arguments,2,"Expected an array of ",a.length," elements, instead of ",b.length," elements.");for(var c=0;c<a.length;c++)this.__assert__(a[c]==b[c],arguments,2,"Value ",b[c]," at ",c," should be equal (==) to ",a[c],".")}});return a});